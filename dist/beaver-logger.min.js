!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define("beaver",[],n):"object"==typeof exports?exports.beaver=n():e.beaver=n()}("undefined"!=typeof self?self:this,(function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(r,o,function(n){return e[n]}.bind(null,o));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return{}.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}function o(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&"function"==typeof window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&"function"==typeof window.constructor&&e instanceof window.constructor)return!1;var n={}.toString;if(n){var t=n.call(e);if("[object Window]"===t||"[object global]"===t||"[object DOMWindow]"===t)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}t.r(n);var i,u=[],s=[],c=0;function f(){if(!c&&i){var e=i;i=null,e.resolve()}}function a(){c+=1}function d(){c-=1,f()}var l=function(){function e(e){var n=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],e){var t,r,o=!1,i=!1,u=!1;a();try{e((function(e){u?n.resolve(e):(o=!0,t=e)}),(function(e){u?n.reject(e):(i=!0,r=e)}))}catch(e){return d(),void this.reject(e)}d(),u=!0,o?this.resolve(t):i&&this.reject(r)}}var n=e.prototype;return n.resolve=function(e){if(this.resolved||this.rejected)return this;if(o(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},n.reject=function(e){var n=this;if(this.resolved||this.rejected)return this;if(o(e))throw new Error("Can not reject promise with another promise");if(!e){var t=e&&"function"==typeof e.toString?e.toString():{}.toString.call(e);e=new Error("Expected reject to be called with Error, got "+t)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout((function(){n.errorHandled||function(e,n){if(-1===u.indexOf(e)){u.push(e),setTimeout((function(){throw e}),1);for(var t=0;t<s.length;t++)s[t](e,n)}}(e,n)}),1),this.dispatch(),this},n.asyncReject=function(e){return this.errorHandled=!0,this.reject(e),this},n.dispatch=function(){var n=this.resolved,t=this.rejected,r=this.handlers;if(!this.dispatching&&(n||t)){this.dispatching=!0,a();for(var i=function(e,n){return e.then((function(e){n.resolve(e)}),(function(e){n.reject(e)}))},u=0;u<r.length;u++){var s=r[u],c=s.onSuccess,f=s.onError,l=s.promise,h=void 0;if(n)try{h=c?c(this.value):this.value}catch(e){l.reject(e);continue}else if(t){if(!f){l.reject(this.error);continue}try{h=f(this.error)}catch(e){l.reject(e);continue}}h instanceof e&&(h.resolved||h.rejected)?(h.resolved?l.resolve(h.value):l.reject(h.error),h.errorHandled=!0):o(h)?h instanceof e&&(h.resolved||h.rejected)?h.resolved?l.resolve(h.value):l.reject(h.error):i(h,l):l.resolve(h)}r.length=0,this.dispatching=!1,d()}},n.then=function(n,t){if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.then expected a function for success handler");if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for error handler");var r=new e;return this.handlers.push({promise:r,onSuccess:n,onError:t}),this.errorHandled=!0,this.dispatch(),r},n.catch=function(e){return this.then(void 0,e)},n.finally=function(n){if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.finally expected a function");return this.then((function(t){return e.try(n).then((function(){return t}))}),(function(t){return e.try(n).then((function(){throw t}))}))},n.timeout=function(e,n){var t=this;if(this.resolved||this.rejected)return this;var r=setTimeout((function(){t.resolved||t.rejected||t.reject(n||new Error("Promise timed out after "+e+"ms"))}),e);return this.then((function(e){return clearTimeout(r),e}))},n.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},e.resolve=function(n){return n instanceof e?n:o(n)?new e((function(e,t){return n.then(e,t)})):(new e).resolve(n)},e.reject=function(n){return(new e).reject(n)},e.asyncReject=function(n){return(new e).asyncReject(n)},e.all=function(n){var t=new e,r=n.length,i=[];if(!r)return t.resolve(i),t;for(var u=function(e,n,o){return n.then((function(n){i[e]=n,0==(r-=1)&&t.resolve(i)}),(function(e){o.reject(e)}))},s=0;s<n.length;s++){var c=n[s];if(c instanceof e){if(c.resolved){i[s]=c.value,r-=1;continue}}else if(!o(c)){i[s]=c,r-=1;continue}u(s,e.resolve(c),t)}return 0===r&&t.resolve(i),t},e.hash=function(n){var t={};return e.all(Object.keys(n).map((function(r){return e.resolve(n[r]).then((function(e){t[r]=e}))}))).then((function(){return t}))},e.map=function(n,t){return e.all(n.map(t))},e.onPossiblyUnhandledException=function(e){return function(e){return s.push(e),{cancel:function(){s.splice(s.indexOf(e),1)}}}(e)},e.try=function(n,t,r){if(n&&"function"!=typeof n&&!n.call)throw new Error("Promise.try expected a function");var o;a();try{o=n.apply(t,r||[])}catch(n){return d(),e.reject(n)}return d(),e.resolve(o)},e.delay=function(n){return new e((function(e){setTimeout(e,n)}))},e.isPromise=function(n){return!!(n&&n instanceof e)||o(n)},e.flush=function(){return n=i=i||new e,f(),n;var n},e}();function h(){}function v(e,n){void 0===n&&(n=Boolean);var t={};for(var r in e)e.hasOwnProperty(r)&&n(e[r],r)&&(t[r]=e[r]);return t}function p(){return"undefined"!=typeof window}Object.create(Error.prototype);var w={CONTENT_TYPE:"content-type",ACCEPT:"accept"},y=[],m={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"},j={FILE:"file:"},g=[m.WARN,m.ERROR],E=[m.ERROR,m.WARN,m.INFO,m.DEBUG],O=6e4,b=m.WARN;function T(e){return function(e){var n=e.url,t=e.method,r=void 0===t?"get":t,o=e.headers,i=void 0===o?{}:o,u=e.json,s=e.data,c=e.body,f=e.win,a=void 0===f?window:f,d=e.timeout,h=void 0===d?0:d;return new l((function(e,t){if(u&&s||u&&c||s&&u)throw new Error("Only options.json or options.data or options.body should be passed");for(var o={},f=0,d=Object.keys(i);f<d.length;f++){var l=d[f];o[l.toLowerCase()]=i[l]}u?o[w.CONTENT_TYPE]=o[w.CONTENT_TYPE]||"application/json":(s||c)&&(o[w.CONTENT_TYPE]=o[w.CONTENT_TYPE]||"application/x-www-form-urlencoded; charset=utf-8"),o[w.ACCEPT]=o[w.ACCEPT]||"application/json";for(var v=0;v<y.length;v++)for(var p=(0,y[v])(),m=0,j=Object.keys(p);m<j.length;m++){var g=j[m];o[g.toLowerCase()]=p[g]}var E=new a.XMLHttpRequest;for(var O in E.addEventListener("load",(function(){var o=function(e){void 0===e&&(e="");for(var n={},t=0,r=e.trim().split("\n");t<r.length;t++){var o=r[t].split(":"),i=o[0],u=o.slice(1);n[i.toLowerCase()]=u.join(":").trim()}return n}(this.getAllResponseHeaders());if(!this.status)return t(new Error("Request to "+r.toLowerCase()+" "+n+" failed: no response status code."));var i=o["content-type"],u=i&&(0===i.indexOf("application/json")||0===i.indexOf("text/json")),s=this.responseText;try{s=JSON.parse(s)}catch(e){if(u)return t(new Error("Invalid json: "+this.responseText+"."))}return e({status:this.status,headers:o,body:s})}),!1),E.addEventListener("error",(function(e){t(new Error("Request to "+r.toLowerCase()+" "+n+" failed: "+e.toString()+"."))}),!1),E.open(r,n,!0),o)o.hasOwnProperty(O)&&E.setRequestHeader(O,o[O]);u?c=JSON.stringify(u):s&&(c=Object.keys(s).map((function(e){return encodeURIComponent(e)+"="+(s?encodeURIComponent(s[e]):"")})).join("&")),E.timeout=h,E.ontimeout=function(){t(new Error("Request to "+r.toLowerCase()+" "+n+" has timed out"))},E.send(c)}))}({url:e.url,method:e.method,headers:e.headers,json:e.json}).then(h)}function P(e,n){for(var t in n)n.hasOwnProperty(t)&&n[t]&&!e[t]&&(e[t]=n[t])}function R(e){var n=e.url,t=e.prefix,o=e.logLevel,i=void 0===o?b:o,u=e.transport,s=void 0===u?T:u,c=e.flushInterval,f=void 0===c?O:c,a=[],d=[],w=[],y=[],R=[],x=[];function C(e,n,t){if(p()&&window.console&&window.console.log&&!(E.indexOf(e)>E.indexOf(i))){var r=[n];r.push(t),(t.error||t.warning)&&r.push("\n\n",t.error||t.warning);try{window.console[e]&&window.console[e].apply?window.console[e].apply(window.console,r):window.console.log&&window.console.log.apply&&window.console.log.apply(window.console,r)}catch(e){}}}function N(){return l.try((function(){if(p()&&window.location.protocol!==j.FILE&&(a.length||d.length)){for(var e={},t=0;t<y.length;t++)P(e,(0,y[t])(e));for(var r={},o=0;o<x.length;o++)P(r,(0,x[o])(r));var i=s({method:"POST",url:n,headers:r,json:{events:a,meta:e,tracking:d}});return a=[],d=[],i.then(h)}}))}var _,L,S,H,k,A=(void 0===L&&(L=50),function(e,n){try{delete e.name,e.name=n}catch(e){}return e.__name__=e.displayName=n,e}((function(){H&&clearTimeout(H);var e=S=S||new l;return H=setTimeout((function(){S=null,H=null,l.try(_).then((function(n){e.resolve(n)}),(function(n){e.reject(n)}))}),L),e}),((k=_=N).name||k.__name__||k.displayName||"anonymous")+"::promiseDebounced"));function B(e,n,o){if(void 0===o&&(o={}),!p())return W;t&&(n=t+"_"+n);for(var i=r({},v(o),{timestamp:Date.now().toString()}),u=0;u<w.length;u++)P(i,(0,w[u])(i));return function(e,n,t){a.push({level:e,event:n,payload:t}),-1!==g.indexOf(e)&&A()}(e,n,i),C(e,n,i),W}function I(e,n){return e.push(n),W}p()&&function(e,n){!function t(){setTimeout((function(){e(),t()}),n)}()}(A,f);var W={debug:function(e,n){return B(m.DEBUG,e,n)},info:function(e,n){return B(m.INFO,e,n)},warn:function(e,n){return B(m.WARN,e,n)},error:function(e,n){return B(m.ERROR,e,n)},track:function(e){if(void 0===e&&(e={}),!p())return W;for(var n=v(e),t=0;t<R.length;t++)P(n,(0,R[t])(n));return C(m.DEBUG,"track",n),d.push(n),W},flush:A,immediateFlush:N,addPayloadBuilder:function(e){return I(w,e)},addMetaBuilder:function(e){return I(y,e)},addTrackingBuilder:function(e){return I(R,e)},addHeaderBuilder:function(e){return I(x,e)},setTransport:function(e){return s=e,W}};return W}t.d(n,"Logger",(function(){return R})),t.d(n,"LOG_LEVEL",(function(){return m})),t.d(n,"PROTOCOL",(function(){return j}))}])}));
//# sourceMappingURL=beaver-logger.min.js.map