!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("beaver",[],t):"object"==typeof exports?exports.beaver=t():e.beaver=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";function n(e){try{if(!e)return!1;if("undefined"!=typeof Promise&&e instanceof Promise)return!0;if("undefined"!=typeof window&&window.Window&&e instanceof window.Window)return!1;if("undefined"!=typeof window&&window.constructor&&e instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(e);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if("function"==typeof e.then)return!0}catch(e){return!1}return!1}Object.defineProperty(t,"__esModule",{value:!0}),r.d({},"WeakMap",function(){return k});var o=[],i=[],a=0,c=void 0;function u(){if(!a&&c){var e=c;c=null,e.resolve()}}function s(){a+=1}function f(){a-=1,u()}var l=function(){function e(t){var r=this;if(function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],t){var n=void 0,o=void 0,i=!1,a=!1,c=!1;s();try{t(function(e){c?r.resolve(e):(i=!0,n=e)},function(e){c?r.reject(e):(a=!0,o=e)})}catch(e){return f(),void this.reject(e)}f(),c=!0,i?this.resolve(n):a&&this.reject(o)}}return e.prototype.resolve=function(e){if(this.resolved||this.rejected)return this;if(n(e))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=e,this.dispatch(),this},e.prototype.reject=function(e){var t=this;if(this.resolved||this.rejected)return this;if(n(e))throw new Error("Can not reject promise with another promise");if(!e){var r=e&&"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);e=new Error("Expected reject to be called with Error, got "+r)}return this.rejected=!0,this.error=e,this.errorHandled||setTimeout(function(){t.errorHandled||function(e,t){if(-1===o.indexOf(e)){o.push(e),setTimeout(function(){throw e},1);for(var r=0;r<i.length;r++)i[r](e,t)}}(e,t)},1),this.dispatch(),this},e.prototype.asyncReject=function(e){return this.errorHandled=!0,this.reject(e),this},e.prototype.dispatch=function(){var t=this,r=this.dispatching,o=this.resolved,i=this.rejected,a=this.handlers;if(!r&&(o||i)){this.dispatching=!0,s();for(var c=function(r){var c=a[r],u=c.onSuccess,s=c.onError,f=c.promise,l=void 0;if(o)try{l=u?u(t.value):t.value}catch(e){return f.reject(e),"continue"}else if(i){if(!s)return f.reject(t.error),"continue";try{l=s(t.error)}catch(e){return f.reject(e),"continue"}}l instanceof e&&(l.resolved||l.rejected)?(l.resolved?f.resolve(l.value):f.reject(l.error),l.errorHandled=!0):n(l)?l instanceof e&&(l.resolved||l.rejected)?l.resolved?f.resolve(l.value):f.reject(l.error):l.then(function(e){f.resolve(e)},function(e){f.reject(e)}):f.resolve(l)},u=0;u<a.length;u++)c(u);a.length=0,this.dispatching=!1,f()}},e.prototype.then=function(t,r){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var n=new e;return this.handlers.push({promise:n,onSuccess:t,onError:r}),this.errorHandled=!0,this.dispatch(),n},e.prototype.catch=function(e){return this.then(void 0,e)},e.prototype.finally=function(t){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.finally expected a function");return this.then(function(r){return e.try(t).then(function(){return r})},function(r){return e.try(t).then(function(){throw r})})},e.prototype.timeout=function(e,t){var r=this;if(this.resolved||this.rejected)return this;var n=setTimeout(function(){r.resolved||r.rejected||r.reject(t||new Error("Promise timed out after "+e+"ms"))},e);return this.then(function(e){return clearTimeout(n),e})},e.prototype.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},e.resolve=function(t){return t instanceof e?t:n(t)?new e(function(e,r){return t.then(e,r)}):(new e).resolve(t)},e.reject=function(t){return(new e).reject(t)},e.asyncReject=function(t){return(new e).asyncReject(t)},e.all=function(t){var r=new e,o=t.length,i=[];if(!o)return r.resolve(i),r;for(var a=function(a){var c=t[a];if(c instanceof e){if(c.resolved)return i[a]=c.value,o-=1,"continue"}else if(!n(c))return i[a]=c,o-=1,"continue";e.resolve(c).then(function(e){i[a]=e,0==(o-=1)&&r.resolve(i)},function(e){r.reject(e)})},c=0;c<t.length;c++)a(c);return 0===o&&r.resolve(i),r},e.hash=function(t){var r={};return e.all(Object.keys(t).map(function(n){return e.resolve(t[n]).then(function(e){r[n]=e})})).then(function(){return r})},e.map=function(t,r){return e.all(t.map(r))},e.onPossiblyUnhandledException=function(e){return function(e){return i.push(e),{cancel:function(){i.splice(i.indexOf(e),1)}}}(e)},e.try=function(t,r,n){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.try expected a function");var o=void 0;s();try{o=t.apply(r,n||[])}catch(t){return f(),e.reject(t)}return f(),e.resolve(o)},e.delay=function(t){return new e(function(e){setTimeout(e,t)})},e.isPromise=function(t){return!!(t&&t instanceof e)||n(t)},e.flush=function(){return t=c=c||new e,u(),t;var t},e}(),d={MOCK:"mock:",FILE:"file:",ABOUT:"about:"},h="Call was rejected by callee.\r\n";function p(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:window).location.protocol===d.ABOUT}function w(e){try{return e&&e.location&&e.location.href,!0}catch(e){}return!1}function v(e){var t=(e=e||window).location;if(!t)throw new Error("Can not read window location");var r=t.protocol;if(!r)throw new Error("Can not read window protocol");if(r===d.FILE)return d.FILE+"//";if(r===d.ABOUT){var n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){}}(e);return n&&w(n)?v(n):d.ABOUT+"//"}var o=t.host;if(!o)throw new Error("Can not read window host");return r+"//"+o}function y(e){var t=v(e=e||window);return t&&e.mockDomain&&0===e.mockDomain.indexOf(d.MOCK)?e.mockDomain:t}var m=[],g=[];function j(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||e.message!==h}if(t&&function(e){if(!function(e){try{if(e===window)return!0}catch(e){}try{var t=Object.getOwnPropertyDescriptor(e,"location");if(t&&!1===t.enumerable)return!1}catch(e){}try{if(p(e)&&w(e))return!0}catch(e){}try{if(v(e)===v(window))return!0}catch(e){}return!1}(e))return!1;try{if(e===window)return!0;if(p(e)&&w(e))return!0;if(y(window)===y(e))return!0}catch(e){}return!1}(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}var r=function(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}(m,e);if(-1!==r){var n=g[r];if(n&&function(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var t=e.ownerDocument;return!(!t||!t.documentElement||t.documentElement.contains(e))}(n))return!0}return!1}function E(e){try{if(e===window)return!0}catch(e){if(e&&e.message===h)return!0}try{if("[object Window]"===Object.prototype.toString.call(e))return!0}catch(e){if(e&&e.message===h)return!0}try{if(window.Window&&e instanceof window.Window)return!0}catch(e){if(e&&e.message===h)return!0}try{if(e&&e.self===e)return!0}catch(e){if(e&&e.message===h)return!0}try{if(e&&e.parent===e)return!0}catch(e){if(e&&e.message===h)return!0}try{if(e&&e.top===e)return!0}catch(e){if(e&&e.message===h)return!0}try{if(e&&"__unlikely_value__"===e.__cross_domain_utils_window_check__)return!1}catch(e){return!0}return!1}function O(e,t){for(var r=0;r<e.length;r++)try{if(e[r]===t)return r}catch(e){}return-1}var b=Object.defineProperty,_=Date.now()%1e9,k=function(){function e(){if(function(t,r){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),_+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+_,function(){if("undefined"==typeof WeakMap)return!1;if(void 0===Object.freeze)return!1;try{var e=new WeakMap,t={};return Object.freeze(t),e.set(t,"__testvalue__"),"__testvalue__"===e.get(t)}catch(e){return!1}}())try{this.weakmap=new WeakMap}catch(e){}this.keys=[],this.values=[]}return e.prototype._cleanupClosedWindows=function(){for(var e=this.weakmap,t=this.keys,r=0;r<t.length;r++){var n=t[r];if(E(n)&&j(n)){if(e)try{e.delete(n)}catch(e){}t.splice(r,1),this.values.splice(r,1),r-=1}}},e.prototype.isSafeToReadWrite=function(e){if(E(e))return!1;try{e&&e.self,e&&e[this.name]}catch(e){return!1}return!0},e.prototype.set=function(e,t){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.set(e,t)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var n=this.name,o=e[n];return void(o&&o[0]===e?o[1]=t:b(e,n,{value:[e,t],writable:!0}))}catch(e){}this._cleanupClosedWindows();var i=this.keys,a=this.values,c=O(i,e);-1===c?(i.push(e),a.push(t)):a[c]=t},e.prototype.get=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(e))return t.get(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return r&&r[0]===e?r[1]:void 0}catch(e){}this._cleanupClosedWindows();var n=O(this.keys,e);if(-1!==n)return this.values[n]},e.prototype.delete=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{t.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];r&&r[0]===e&&(r[0]=r[1]=void 0)}catch(e){}this._cleanupClosedWindows();var n=this.keys,o=O(n,e);-1!==o&&(n.splice(o,1),this.values.splice(o,1))},e.prototype.has=function(e){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(e))return!0}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e))try{var r=e[this.name];return!(!r||r[0]!==e)}catch(e){}return this._cleanupClosedWindows(),-1!==O(this.keys,e)},e.prototype.getOrSet=function(e,t){if(this.has(e))return this.get(e);var r=t();return this.set(e,r),r},e}();function T(){}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Boolean,r={};for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)&&(r[n]=e[n]);return r}function R(){return"undefined"!=typeof window}"function"==typeof Symbol&&Symbol.iterator,"function"==typeof Symbol&&Symbol.iterator,Object.assign,Object.create(Error.prototype);var x={CONTENT_TYPE:"content-type",ACCEPT:"accept"},P=[],W={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error"},L={FILE:"file:"},S=[W.WARN,W.ERROR],N=[W.ERROR,W.WARN,W.INFO,W.DEBUG],M=6e4,A=W.WARN,B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};function D(e){return function(e){var t=e.url,r=e.method,n=void 0===r?"get":r,o=e.headers,i=void 0===o?{}:o,a=e.json,c=e.data,u=e.body,s=e.win,f=void 0===s?window:s,d=e.timeout,h=void 0===d?0:d;return new l(function(e,r){if(a&&c||a&&u||c&&a)throw new Error("Only options.json or options.data or options.body should be passed");for(var o={},s=0,l=Object.keys(i),d=null==l?0:l.length;s<d;s++){var p=l[s];o[p.toLowerCase()]=i[p]}a?o[x.CONTENT_TYPE]=o[x.CONTENT_TYPE]||"application/json":(c||u)&&(o[x.CONTENT_TYPE]=o[x.CONTENT_TYPE]||"application/x-www-form-urlencoded; charset=utf-8"),o[x.ACCEPT]=o[x.ACCEPT]||"application/json";for(var w=0,v=null==P?0:P.length;w<v;w++)for(var y=(0,P[w])(),m=0,g=Object.keys(y),j=null==g?0:g.length;m<j;m++){var E=g[m];o[E.toLowerCase()]=y[E]}var O=new f.XMLHttpRequest;for(var b in O.addEventListener("load",function(){var o=function(){for(var e={},t=0,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").trim().split("\n"),n=null==r?0:r.length;t<n;t++){var o=r[t].split(":"),i=o[0],a=o.slice(1);e[i.toLowerCase()]=a.join(":").trim()}return e}(this.getAllResponseHeaders());if(!this.status)return r(new Error("Request to "+n.toLowerCase()+" "+t+" failed: no response status code."));var i=o["content-type"],a=i&&(0===i.indexOf("application/json")||0===i.indexOf("text/json")),c=this.responseText;try{c=JSON.parse(c)}catch(e){if(a)return r(new Error("Invalid json: "+this.responseText+"."))}var u={status:this.status,headers:o,body:c};return e(u)},!1),O.addEventListener("error",function(e){r(new Error("Request to "+n.toLowerCase()+" "+t+" failed: "+e.toString()+"."))},!1),O.open(n,t,!0),o)o.hasOwnProperty(b)&&O.setRequestHeader(b,o[b]);a?u=JSON.stringify(a):c&&(u=Object.keys(c).map(function(e){return encodeURIComponent(e)+"="+(c?encodeURIComponent(c[e]):"")}).join("&")),O.timeout=h,O.ontimeout=function(){r(new Error("Request to "+n.toLowerCase()+" "+t+" has timed out"))},O.send(u)})}({url:e.url,method:e.method,headers:e.headers,json:e.json}).then(T)}function I(e,t){for(var r in t)t.hasOwnProperty(r)&&t[r]&&!e[r]&&(e[r]=t[r])}function U(e){var t=e.url,r=e.prefix,n=e.logLevel,o=void 0===n?A:n,i=e.transport,a=void 0===i?D:i,c=e.flushInterval,u=void 0===c?M:c,s=[],f=[],d=[],h=[],p=[],w=[];function v(e,t,r){if(R()&&window.console&&window.console.log){var n=o;if(window.LOG_LEVEL&&-1!==N.indexOf(window.LOG_LEVEL)&&(n=window.LOG_LEVEL),!(N.indexOf(e)>N.indexOf(n))){var i=[t];i.push(r),(r.error||r.warning)&&i.push("\n\n",r.error||r.warning);try{window.console[e]&&window.console[e].apply?window.console[e].apply(window.console,i):window.console.log&&window.console.log.apply&&window.console.log.apply(window.console,i)}catch(e){}}}}function y(){return l.try(function(){if(R()&&window.location.protocol!==L.FILE&&(s.length||f.length)){for(var e={},r=0,n=null==h?0:h.length;r<n;r++)I(e,(0,h[r])(e));for(var o={},i=0,c=null==w?0:w.length;i<c;i++)I(o,(0,w[i])(o));var u=a({method:"POST",url:t,headers:o,json:{events:s,meta:e,tracking:f}});return s=[],f=[],u.then(T)}})}var m,g,j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,r=void 0,n=void 0;return function(){n&&clearTimeout(n);var o=r=r||new l;return n=setTimeout(function(){r=null,n=null,l.try(e).then(function(e){o.resolve(e)},function(e){o.reject(e)})},t),o}}(y);function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!R())return b;r&&(t=r+"_"+t);for(var o=B({},C(n),{timestamp:Date.now().toString()}),i=0,a=null==d?0:d.length;i<a;i++)I(o,(0,d[i])(o));return function(e,t,r){s.push({level:e,event:t,payload:r}),-1!==S.indexOf(e)&&j()}(e,t,o),v(e,t,o),b}function O(e,t){return e.push(t),b}R()&&(m=j,g=u,function e(){setTimeout(function(){m(),e()},g)}());var b={debug:function(e,t){return E(W.DEBUG,e,t)},info:function(e,t){return E(W.INFO,e,t)},warn:function(e,t){return E(W.WARN,e,t)},error:function(e,t){return E(W.ERROR,e,t)},track:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!R())return b;for(var t=C(e),r=0,n=null==p?0:p.length;r<n;r++)I(t,(0,p[r])(t));return v(W.DEBUG,"track",t),f.push(t),b},flush:j,immediateFlush:y,addPayloadBuilder:function(e){return O(d,e)},addMetaBuilder:function(e){return O(h,e)},addTrackingBuilder:function(e){return O(p,e)},addHeaderBuilder:function(e){return O(w,e)},setTransport:function(e){return a=e,b}};return b}r.d(t,"Logger",function(){return U}),r.d(t,"LOG_LEVEL",function(){return W}),r.d(t,"PROTOCOL",function(){return L})}])});
//# sourceMappingURL=beaver-logger.min.js.map