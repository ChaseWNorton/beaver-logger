!function(n,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("beaver",[],t):"object"==typeof exports?exports.beaver=t():n.beaver=t()}("undefined"!=typeof self?self:this,(function(){return function(n){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return n[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=n,r.c=t,r.d=function(n,t,i){r.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:i})},r.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,t){if(1&t&&(n=r(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)r.d(i,o,function(t){return n[t]}.bind(null,o));return i},r.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(t,"a",t),t},r.o=function(n,t){return{}.hasOwnProperty.call(n,t)},r.p="",r(r.s=0)}([function(n,t,r){"use strict";function i(){return(i=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)({}).hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n}).apply(this,arguments)}function o(n){try{if(!n)return!1;if("undefined"!=typeof Promise&&n instanceof Promise)return!0;if("undefined"!=typeof window&&"function"==typeof window.Window&&n instanceof window.Window)return!1;if("undefined"!=typeof window&&"function"==typeof window.constructor&&n instanceof window.constructor)return!1;var t={}.toString;if(t){var r=t.call(n);if("[object Window]"===r||"[object global]"===r||"[object DOMWindow]"===r)return!1}if("function"==typeof n.then)return!0}catch(n){return!1}return!1}r.r(t);var e,u=[],f=[],c=0;function a(){if(!c&&e){var n=e;e=null,n.resolve()}}function s(){c+=1}function d(){c-=1,a()}var h=function(){function n(n){var t=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],n){var r,i,o=!1,e=!1,u=!1;s();try{n((function(n){u?t.resolve(n):(o=!0,r=n)}),(function(n){u?t.reject(n):(e=!0,i=n)}))}catch(n){return d(),void this.reject(n)}d(),u=!0,o?this.resolve(r):e&&this.reject(i)}}var t=n.prototype;return t.resolve=function(n){if(this.resolved||this.rejected)return this;if(o(n))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=n,this.dispatch(),this},t.reject=function(n){var t=this;if(this.resolved||this.rejected)return this;if(o(n))throw new Error("Can not reject promise with another promise");if(!n){var r=n&&"function"==typeof n.toString?n.toString():{}.toString.call(n);n=new Error("Expected reject to be called with Error, got "+r)}return this.rejected=!0,this.error=n,this.errorHandled||setTimeout((function(){t.errorHandled||function(n,t){if(-1===u.indexOf(n)){u.push(n),setTimeout((function(){throw n}),1);for(var r=0;r<f.length;r++)f[r](n,t)}}(n,t)}),1),this.dispatch(),this},t.asyncReject=function(n){return this.errorHandled=!0,this.reject(n),this},t.dispatch=function(){var t=this.resolved,r=this.rejected,i=this.handlers;if(!this.dispatching&&(t||r)){this.dispatching=!0,s();for(var e=function(n,t){return n.then((function(n){t.resolve(n)}),(function(n){t.reject(n)}))},u=0;u<i.length;u++){var f=i[u],c=f.onSuccess,a=f.onError,h=f.promise,v=void 0;if(t)try{v=c?c(this.value):this.value}catch(n){h.reject(n);continue}else if(r){if(!a){h.reject(this.error);continue}try{v=a(this.error)}catch(n){h.reject(n);continue}}v instanceof n&&(v.resolved||v.rejected)?(v.resolved?h.resolve(v.value):h.reject(v.error),v.errorHandled=!0):o(v)?v instanceof n&&(v.resolved||v.rejected)?v.resolved?h.resolve(v.value):h.reject(v.error):e(v,h):h.resolve(v)}i.length=0,this.dispatching=!1,d()}},t.then=function(t,r){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.then expected a function for success handler");if(r&&"function"!=typeof r&&!r.call)throw new Error("Promise.then expected a function for error handler");var i=new n;return this.handlers.push({promise:i,onSuccess:t,onError:r}),this.errorHandled=!0,this.dispatch(),i},t.catch=function(n){return this.then(void 0,n)},t.finally=function(t){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.finally expected a function");return this.then((function(r){return n.try(t).then((function(){return r}))}),(function(r){return n.try(t).then((function(){throw r}))}))},t.timeout=function(n,t){var r=this;if(this.resolved||this.rejected)return this;var i=setTimeout((function(){r.resolved||r.rejected||r.reject(t||new Error("Promise timed out after "+n+"ms"))}),n);return this.then((function(n){return clearTimeout(i),n}))},t.toPromise=function(){if("undefined"==typeof Promise)throw new TypeError("Could not find Promise");return Promise.resolve(this)},n.resolve=function(t){return t instanceof n?t:o(t)?new n((function(n,r){return t.then(n,r)})):(new n).resolve(t)},n.reject=function(t){return(new n).reject(t)},n.asyncReject=function(t){return(new n).asyncReject(t)},n.all=function(t){var r=new n,i=t.length,e=[];if(!i)return r.resolve(e),r;for(var u=function(n,t,o){return t.then((function(t){e[n]=t,0==(i-=1)&&r.resolve(e)}),(function(n){o.reject(n)}))},f=0;f<t.length;f++){var c=t[f];if(c instanceof n){if(c.resolved){e[f]=c.value,i-=1;continue}}else if(!o(c)){e[f]=c,i-=1;continue}u(f,n.resolve(c),r)}return 0===i&&r.resolve(e),r},n.hash=function(t){var r={};return n.all(Object.keys(t).map((function(i){return n.resolve(t[i]).then((function(n){r[i]=n}))}))).then((function(){return r}))},n.map=function(t,r){return n.all(t.map(r))},n.onPossiblyUnhandledException=function(n){return function(n){return f.push(n),{cancel:function(){f.splice(f.indexOf(n),1)}}}(n)},n.try=function(t,r,i){if(t&&"function"!=typeof t&&!t.call)throw new Error("Promise.try expected a function");var o;s();try{o=t.apply(r,i||[])}catch(t){return d(),n.reject(t)}return d(),n.resolve(o)},n.delay=function(t){return new n((function(n){setTimeout(n,t)}))},n.isPromise=function(t){return!!(t&&t instanceof n)||o(t)},n.flush=function(){return t=e=e||new n,a(),t;var t},n}();function v(){}function w(n,t){void 0===t&&(t=Boolean);var r={};for(var i in n)n.hasOwnProperty(i)&&t(n[i],i)&&(r[i]=n[i]);return r}function l(){return"undefined"!=typeof window}Object.create(Error.prototype);var p={u:"content-type",h:"accept"},m=[],y={v:"debug",j:"info",O:"warn",ERROR:"error"},b={T:"file:"},j=[y.O,y.ERROR],E=[y.ERROR,y.O,y.j,y.v],O=6e4,T=y.O;function P(n,t){for(var r in t)t.hasOwnProperty(r)&&t[r]&&!n[r]&&(n[r]=t[r])}function g(n){var t=n.url,r=n.prefix,o=n.logLevel,e=void 0===o?T:o,u=n.flushInterval,f=void 0===u?O:u,c=[],a=[],s=[],d=[],g=[],x=[];function R(n,t,r){if(l()&&window.console&&window.console.log){var i=e;if(window.LOG_LEVEL&&-1!==E.indexOf(window.LOG_LEVEL)&&(i=window.LOG_LEVEL),!(E.indexOf(n)>E.indexOf(i))){var o=[t];o.push(r),(r.error||r.warning)&&o.push("\n\n",r.error||r.warning);try{window.console[n]&&window.console[n].apply?window.console[n].apply(window.console,o):window.console.log&&window.console.log.apply&&window.console.log.apply(window.console,o)}catch(n){}}}}function C(){if(!l()||window.location.protocol===b.T||!c.length&&!a.length)return h.resolve();var n=function(){for(var n={},t=0;t<d.length;t++)P(n,(0,d[t])(n));for(var r={},i=0;i<x.length;i++)P(r,(0,x[i])(r));return{meta:n,headers:r}}(),r={events:c,meta:n.meta,tracking:a};return c=[],a=[],function(n){var t=n.url,r=n.method,i=void 0===r?"get":r,o=n.headers,e=void 0===o?{}:o,u=n.json,f=n.data,c=n.body,a=n.win,s=void 0===a?window:a,d=n.timeout,v=void 0===d?0:d;return new h((function(n,r){if(u&&f||u&&c||f&&u)throw new Error("Only options.json or options.data or options.body should be passed");for(var o={},a=0,d=Object.keys(e);a<d.length;a++){var h=d[a];o[h.toLowerCase()]=e[h]}u?o[p.u]=o[p.u]||"application/json":(f||c)&&(o[p.u]=o[p.u]||"application/x-www-form-urlencoded; charset=utf-8"),o[p.h]=o[p.h]||"application/json";for(var w=0;w<m.length;w++)for(var l=(0,m[w])(),y=0,b=Object.keys(l);y<b.length;y++){var j=b[y];o[j.toLowerCase()]=l[j]}var E=new s.XMLHttpRequest;for(var O in E.addEventListener("load",(function(){var o=function(n){void 0===n&&(n="");for(var t={},r=0,i=n.trim().split("\n");r<i.length;r++){var o=i[r].split(":"),e=o[0],u=o.slice(1);t[e.toLowerCase()]=u.join(":").trim()}return t}(this.getAllResponseHeaders());if(!this.status)return r(new Error("Request to "+i.toLowerCase()+" "+t+" failed: no response status code."));var e=o["content-type"],u=e&&(0===e.indexOf("application/json")||0===e.indexOf("text/json")),f=this.responseText;try{f=JSON.parse(f)}catch(n){if(u)return r(new Error("Invalid json: "+this.responseText+"."))}return n({status:this.status,headers:o,body:f})}),!1),E.addEventListener("error",(function(n){r(new Error("Request to "+i.toLowerCase()+" "+t+" failed: "+n.toString()+"."))}),!1),E.open(i,t,!0),o)o.hasOwnProperty(O)&&E.setRequestHeader(O,o[O]);u?c=JSON.stringify(u):f&&(c=Object.keys(f).map((function(n){return encodeURIComponent(n)+"="+(f?encodeURIComponent(f[n]):"")})).join("&")),E.timeout=v,E.ontimeout=function(){r(new Error("Request to "+i.toLowerCase()+" "+t+" has timed out"))},E.send(c)}))}({method:"POST",url:t,headers:n.headers,json:r}).then(v)}var S,B,L,N,I,_=(void 0===B&&(B=50),function(n,t){try{delete n.name,n.name=t}catch(n){}return n.__name__=n.displayName=t,n}((function(){N&&clearTimeout(N);var n=L=L||new h;return N=setTimeout((function(){L=null,N=null,h.try(S).then((function(t){n.resolve(t)}),(function(t){n.reject(t)}))}),B),n}),((I=S=C).name||I.__name__||I.displayName||"anonymous")+"::promiseDebounced"));function k(n,t,o){if(void 0===o&&(o={}),!l())return M;r&&(t=r+"_"+t);for(var e=i({},w(o),{timestamp:Date.now().toString()}),u=0;u<s.length;u++)P(e,(0,s[u])(e));return function(n,t,r){c.push({level:n,event:t,payload:r}),-1!==j.indexOf(n)&&_()}(n,t,e),R(n,t,e),M}function D(n,t){return n.push(t),M}l()&&function(n,t){!function r(){setTimeout((function(){n(),r()}),t)}()}(_,f);var M={debug:function(n,t){return k(y.v,n,t)},info:function(n,t){return k(y.j,n,t)},warn:function(n,t){return k(y.O,n,t)},error:function(n,t){return k(y.ERROR,n,t)},track:function(n){if(void 0===n&&(n={}),!l())return M;for(var t=w(n),r=0;r<g.length;r++)P(t,(0,g[r])(t));return R(y.v,"track",t),a.push(t),M},flush:_,immediateFlush:C,addPayloadBuilder:function(n){return D(s,n)},addMetaBuilder:function(n){return D(d,n)},addTrackingBuilder:function(n){return D(g,n)},addHeaderBuilder:function(n){return D(x,n)}};return M}r.d(t,"Logger",(function(){return g})),r.d(t,"LOG_LEVEL",(function(){return y})),r.d(t,"PROTOCOL",(function(){return b}))}])}));
//# sourceMappingURL=beaver-logger.min.js.map